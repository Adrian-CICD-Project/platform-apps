applications:
  #############################################
  # DEPENDENCY TRACK (WYŁĄCZONY)
  #############################################

  dependencyTrack:
    enabled: false
    name: dependency-track
    namespace: dependency-track

    helmRepoUrl: https://dependencytrack.github.io/helm-charts
    chart: dependency-track
    chartVersion: 0.40.0

    values: |
      ingress:
        enabled: true
        ingressClassName: nginx
        annotations:
          nginx.ingress.kubernetes.io/backend-protocol: HTTP
          nginx.ingress.kubernetes.io/proxy-body-size: "100m"
        hostname: dependency-track.20.67.126.22.nip.io
        path: /

      frontend:
        enabled: true
        replicaCount: 1
        env:
          - name: API_BASE_URL
            value: "/api"

      apiserver:
        enabled: true
        replicaCount: 1
        service:
          type: ClusterIP
          port: 8080

        resources:
          requests:
            cpu: "200m"
            memory: "768Mi"
          limits:
            cpu: "1000m"
            memory: "1536Mi"

        nodeSelector:
          kubernetes.io/os: linux

      # ❗ ŚWIADOMIE WYŁĄCZONE
      postgresql:
        enabled: true

      # ❗ H2 stateless (na test)
      persistence:
        enabled: true

  #############################################
  # MONITORING – KUBE-PROMETHEUS-STACK
  #############################################
  prometheus:
    enabled: true
    name: prometheus
    namespace: monitoring
    helmRepoUrl: https://prometheus-community.github.io/helm-charts
    chart: prometheus
    chartVersion: 25.30.0
    values: |
      server:
        retention: 7d
        persistentVolume:
          enabled: false
        # Kluczowe dla połączenia:
        alerting:
        alertmanagers:
        - static_configs:
            - targets: ["alertmanager:9093"]
          kubernetes_sd_configs: []
          relabel_configs: []

        # Kluczowe dla reguł:
        ruleFiles:
          - /etc/config/alerts

      serverFiles:
        alerts:
          groups:
            - name: adrian-java-app
              rules:
                - alert: AdrianJavaAppHttp500
                  expr: increase(http_server_requests_seconds_count{status="500"}[5m]) > 0
                  for: 0s
                  labels:
                    severity: critical
                  annotations:
                    summary: "HTTP 5xx detected in adrian-java-app"
                    description: "Wykryto błąd 500"

      extraScrapeConfigs: |
        - job_name: "spring-boot"
          metrics_path: /actuator/prometheus
          static_configs:
            - targets:
                - adrian-java-app.environment-dev.svc.cluster.local:80

  alertmanager:
    enabled: true
    name: alertmanager
    namespace: monitoring

    helmRepoUrl: https://prometheus-community.github.io/helm-charts
    chart: alertmanager
    chartVersion: 1.13.1

    values: |
      replicaCount: 1

      extraArgs:
        log.level: debug

      persistence:
        enabled: false

      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 300m
          memory: 256Mi

      config:
        global:
          smtp_smarthost: "smtp.gmail.com:587"
          smtp_from: "adrian.dmytryk@gmail.com"
          smtp_auth_username: "adrian.dmytryk@gmail.com"
          smtp_auth_password_file: "/etc/alertmanager/secrets/alertmanager-gmail/smtp_password"
          smtp_require_tls: true

        route:
          receiver: "gmail"
          group_wait: 10s
          group_interval: 1m
          repeat_interval: 5m
          

        receivers:
          - name: "gmail"
            email_configs:
              - to: "adrian.dmytryk@gmail.com"
                send_resolved: true

      extraSecretMounts:
        - name: alertmanager-gmail
          secretName: alertmanager-gmail
          mountPath: /etc/alertmanager/secrets/alertmanager-gmail
          readOnly: true

  #############################################
  # SONARQUBE – TEST / SLIM
  #############################################
  sonarqube:
    enabled: true
    name: sonarqube
    namespace: sonarqube

    helmRepoUrl: https://SonarSource.github.io/helm-chart-sonarqube
    chart: sonarqube
    chartVersion: 2025.5.0

    values: |
      # ===== COMMUNITY BUILD (bez edition!) =====
      community:
        enabled: true


      startupProbe:
        enabled: false



      # ===== BASIC SETUP =====
      replicaCount: 1

      service:
        type: LoadBalancer
        port: 9000

      # ===== SLIM RESOURCES =====
      resources:
        requests:
          cpu: "200m"
          memory: "1Gi"
        limits:
          cpu: "500m"
          memory: "2Gi"

      # ===== EMBEDDED POSTGRES (SLIM / TEST) =====
      postgresql:
        enabled: true
        primary:
          persistence:
            enabled: false
        resources:
          requests:
            cpu: "100m"
            memory: "512Mi"
          limits:
            cpu: "300m"
            memory: "1Gi"

      # ===== NO PERSISTENCE =====
      persistence:
        enabled: false

      monitoringPasscode: "sonar-monitoring"

  #############################################
  # EXTERNAL SECRETS OPERATOR
  #############################################
  external-secrets:
    enabled: true
    name: external-secrets
    namespace: external-secrets

    helmRepoUrl: https://charts.external-secrets.io
    chart: external-secrets
    chartVersion: 0.12.1

    values: |
      installCRDs: true
      replicaCount: 1
      resources:
        requests:
          cpu: 50m
          memory: 128Mi
        limits:
          cpu: 200m
          memory: 256Mi
